{% extends 'base.html'%}
{% block manage_fram_export%}
{% load static %}
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="{% static 'AppOfDocuments\css\fram_export.css' %}" type="text/css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div class="main-box">
    <div class="section-header">
      Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø·Ø§Ø±Ø§Øª 
    </div>
    <div class="doc-count">
      Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø·Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©: <span id="docCount">{{ templates|length }}</span>
    </div>

    <input type="text" class="search-input" placeholder="Ø¨Ø­Ø« Ù…Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ØŒ Ø§Ù„Ø¬Ù‡Ø©ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®" id="searchInput">

    <table>
      <thead>
        <tr>
          <th>Ø§Ù„Ø±Ù‚Ù…</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
          <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
          <th>Ø§Ù„Ø§Ø·Ø§Ø±</th>
          <th>Ø§Ø®ØªÙŠØ§Ø±</th>
        </tr>
      </thead>
      <tbody id="documentsTable">
        {% for template in templates %}
        <tr>
          <td>{{ template.id }}</td>
          <td>{{ template.employee.username }}</td>
          <td>{{ template.document_title }}</td>
          <td>{{ template.date_time|date:"j" }}{{ template.date_time|date:"F" }}{{ template.date_time|date:"Y" }}</td>
          <td>{{ template.notes }}</td>
          <td> <a href="{% url 'open_word_template' template.id %}">ÙØªØ­ Ø§Ù„Ø¥Ø·Ø§Ø±</a></td>
          <td class="radio-cell"><input type="radio" name="selectDoc" value="{{ template.id }}"></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="buttons">
      <button onclick="deleteDocument()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    </div>
  </div>

  <script>
   // Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  function editDocument() {
    const selected = document.querySelector('input[name="selectDoc"]:checked');
    if (selected) {
      const id = selected.value;
      window.location.href = `/documents/edit_frame_template/${id}/`;
    } else {
      alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ÙˆØ«ÙŠÙ‚Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.");
    }
  }

  // Ø²Ø± Ø§Ù„Ø­Ø°Ù
function deleteDocument() {
  const selected = document.querySelector('input[name="selectDoc"]:checked');
  if (selected) {
    const id = selected.value;

    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø·Ø§Ø±ØŸ")) {
      fetch(`/documents/delete_frame_template/${id}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
        }
      })
      .then(response => {
        if (response.ok) {
          // Ø­Ø°Ù Ø§Ù„ØµÙ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
          const row = selected.closest('tr');
          row.remove();

          // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª
          const countSpan = document.getElementById("docCount");
          const currentCount = parseInt(countSpan.textContent);
          countSpan.textContent = currentCount - 1;

        } else {
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù.");
        }
      });
    }
  } else {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ÙˆØ«ÙŠÙ‚Ø© Ù„Ù„Ø­Ø°Ù.");
  }
}


  // ØªØµÙÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
  document.getElementById("searchInput").addEventListener("input", function () {
    const keyword = this.value.trim().toLowerCase();
    const rows = document.querySelectorAll("#documentsTable tr");

    rows.forEach(row => {
      const cells = row.querySelectorAll("td");
      const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(" ");
      row.style.display = rowText.includes(keyword) ? "" : "none";
    });
  });

  // ÙØªØ­ Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø© (ÙÙ‚Ø· Ø¥Ø°Ø§ Ø±ØºØ¨Øª Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)
  function openTemplate(templateId) {
    fetch(`/documents/open_template/${templateId}/`)
      .then(response => {
        if (!response.ok) {
          alert("ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ø§Ù„Ù…Ø³ØªÙ†Ø¯.");
        }
      });
  }


  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.startsWith(name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }


</script>



  
</body>
{% endblock manage_fram_export %}
