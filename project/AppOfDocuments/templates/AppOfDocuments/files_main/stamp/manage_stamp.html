{% extends 'base.html'%}
 {% block manage_stamp%}
 {% load static %}
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="{% static 'AppOfDocuments\css\export.css' %}" type="text/css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

  <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

  <div class="main-box">
    <div class="section-header">
      Ø¹Ø±Ø¶ Ø§Ù„Ø®ØªÙ… 
    </div>
    <div class="doc-count">
    <span id="docCount">{{ stamps|length }}</span>    </div>

    
  
  <table id="documentsTable">
  <thead>
    <tr>
      <th>id</th>
      <th>Ù†ÙˆØ¹ Ø§Ù„Ø®ØªÙ…</th>
      <th>ØµÙˆØ±Ø© Ø§Ù„Ø®ØªÙ…</th>
      <th>Ø§Ø®ØªÙŠØ§Ø± </th>
    </tr>
  </thead>
  <tbody>
  {% for stamp in stamps %}
    <tr>
      <td>{{ stamp.id }}</td>
      <td>{{ stamp.stamp_type }}</td>
     <td>
  {% if stamp.stamp_image %}
    <a href="{% url 'show_stamp_image' stamp.id %}" target="_blank">Ø¹Ø±Ø¶</a>
  {% else %}
    Ù„Ø§ ÙŠÙˆØ¬Ø¯
  {% endif %}
</td>

      <td class="radio-cell">
        <input type="radio" name="selectDoc" value="{{ stamp.id }}">
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>
  {% endfor %}
</tbody>

    </table>

    <div class="buttons">
      <button onclick="editDocument()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
    <button onclick="deleteDocument()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    </div>
  </div>

  <script>
   function deleteDocument() {
  const selectedRadio = document.querySelector('input[name="selectDoc"]:checked');
  if (!selectedRadio) {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø®ØªÙ… Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ø­Ø°Ù.");
    return;
  }

  const stampId = selectedRadio.value;

  if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø®ØªÙ…ØŸ")) {
    return;
  }

  fetch(`/documents/delete_stamp/${stampId}/`, {
   method: 'POST',
  headers: {
    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value,
  }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Ø­Ø°Ù Ø§Ù„ØµÙ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† ØªØ­Ø¯ÙŠØ« ÙƒØ§Ù…Ù„
      selectedRadio.closest('tr').remove();
const docCountElem = document.getElementById("docCount");
docCountElem.textContent = Number(docCountElem.textContent) - 1;
      alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø®ØªÙ… Ø¨Ù†Ø¬Ø§Ø­.");
    } else {
      alert("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù.");
    }
  })
  .catch(error => {
    console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù:", error);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.");
  });

}


function editDocument() {
  const selectedRadio = document.querySelector('input[name="selectDoc"]:checked');
  if (!selectedRadio) {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø®ØªÙ… Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.");
    return;
  }

  const stampId = selectedRadio.value;
  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹ ID
  window.location.href = `/documents/edit_stamp/${stampId}/`;
}

function printPage() {
  const selectedRadio = document.querySelector('input[name="selectDoc"]:checked');
  if (!selectedRadio) {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ÙˆØ«ÙŠÙ‚Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.");
    return;
  }

  const row = selectedRadio.closest("tr");
  const imageCell = row.querySelector("td:nth-child(7) a");

  if (imageCell && imageCell.href) {
    const imageURL = imageCell.href;
    const printWindow = window.open("", "_blank");
    printWindow.document.write(`
      <html dir="rtl"><head><title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</title></head><body>
      <img src="${imageURL}" style="max-width:100%;height:auto;">
      </body></html>
    `);
    printWindow.document.close();
    printWindow.print();
  } else {
    alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©.");
  }
}


</script>



</body>
{% endblock manage_stamp%}
